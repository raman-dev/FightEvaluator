<nav>
    <div class="sidebar-container">
        <!-- <div class="link"> -->
        <a href="/">
            <div class="link">
                <h4>
                    Event Name
                </h4>
            </div>
        </a>
        <!-- </div> -->
        <!--collapsible container of last 5 visited assessments-->
        <div class="link-wrapper assessment-links">
            <h4>Assessments</h4>
            <div class="link-container">
                <!-- <a href="/assessments class="link">
                    <div ">
                        Fighter Name 0
                    </div>
                </div>
                <div class="link">
                    <a href="/assessments">
                        Fighter Name 1
                    </a>
                </div> -->
            </div>
        </div>
        <!--collapsible container of last 5 visited matchups-->
        <div class="link-wrapper matchup-links">
            <h4>Matchups</h4>
            <div class="link-container">
                <!-- <div class="link">
                    <a href="/matchups">
                        Matchup Name 0
                    </a>
                </div>
                <div class="link">
                    <a href="/matchups">
                        Matchup Name 1
                    </a>
                </div> -->
            </div>
        </div>
    </div>
</nav>
<script>
    function stripIdAndStore(stack, storeKey, data) {
        let inStack = false;
        for (let x in stack) {
            if (x.id == data.id) {
                inStack = true;
            }
        }
        if (!inStack) {
            stack.push(data);
        } else {
            //remove the element from the stack and push it to the top
            stack = stack.filter((item) => item.id !== id);
            stack.push(data);
        }
        //remove the last element of the stack if size is greater than 5
        if (stack.length > 5) {
            stack.shift();
        }
        // Convert the array to a JSON string and store it in localStorage
        localStorage.setItem(storeKey, JSON.stringify(stack));
    }

    function addSideBarLinks(stack, linkContainer, path) {
        for (let i = stack.length - 1; i >= 0; i--) {
            let data = stack[i];
            let link = document.createElement('a');
            link.href = `/${path}/${data.id}`;
            link.innerHTML = `<div class="link">${data.data}</div>`;
            linkContainer.appendChild(link);
        }
    }

    //if current domain is /assessment then set cookie for assessment_id_0 -> assessment_id

    // Retrieve the JSON string from localStorage
    let assessmentStack = localStorage.getItem('assessments');
    if (assessmentStack == null) {
        assessmentStack = [];
    } else {
        // Parse the JSON string back into an array
        assessmentStack = JSON.parse(assessmentStack);
    }

    let matchupStack = localStorage.getItem('matchups');
    if (matchupStack == null) {
        matchupStack = [];
    } else {
        matchupStack = JSON.parse(matchupStack);
    }

    //get url of current page
    let url = window.location.href;
    let url_parts = url.split('/');
    let id = parseInt(url_parts[url_parts.length - 1]);
    //
    if (url.includes('assessment')) {
        stripIdAndStore(assessmentStack, 'assessments', {
            id: id,
            data: "{{ fighter.last_name if fighter }}"
        });
        document.querySelector('.assessment-links').classList.add('active');
    }
    if (url.includes('matchup')) {
        document.querySelector('.matchup-links').classList.add('active');
        stripIdAndStore(matchupStack, 'matchups',{ id:id, data:"{{ matchup.fighter_a + 'vs' + matchup.fighter_b if matchup}}" });
    }

    addSideBarLinks(assessmentStack, document.querySelector('.assessment-links .link-container'), 'assessment');
    addSideBarLinks(matchupStack, document.querySelector('.matchup-links .link-container'), 'matchup');

    //on click sidebar link wrapper expand to height of content
    document.querySelectorAll('.sidebar-container .link-wrapper').forEach((linkWrapper) => {
        let lc = linkWrapper.querySelector('.link-container');
        if (linkWrapper.classList.contains('active')) {
            lc.style.height = lc.scrollHeight + 'px';
        }
        linkWrapper.addEventListener('click', (event) => {
            //check if linkWrapper is already expanded
            let linkContainer = linkWrapper.querySelector('.link-container');
            if (linkWrapper.classList.contains('active')) {
                //if it is expanded, collapse it
                linkWrapper.classList.remove('active');
                linkContainer.style.height = '0px';
                return;
            }
            linkWrapper.classList.add('active');
            //get the height of the link-container
            let linkContainerHeight = linkContainer.scrollHeight;
            linkContainer.style.height = linkContainerHeight + 'px';
        });
    });

    document.querySelectorAll('.link-container').forEach((linkContainer) => {
        linkContainer.style.transition = 'all 0.3s ease-in-out';
    });

</script>